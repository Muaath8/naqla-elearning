// استخراج ID من أي رابط يوتيوب
function getYouTubeId(u){
  if(!u) return "";
  try{
    // يدعم: watch?v=ID أو youtu.be/ID أو embed/ID
    const url = new URL(u);
    if(url.hostname.includes('youtu.be')) return url.pathname.slice(1);
    if(url.searchParams.get('v')) return url.searchParams.get('v');
    const m = url.pathname.match(/embed\/([^/?#]+)/);
    return m ? m[1] : "";
  }catch{ // لو كانت قيمة هي نفسها ID
    return String(u);
  }
}

// عنصر فيديو خفيف: صورة + زر تشغيل → عند الضغط ينشئ iframe
function renderVideo(container, urlOrId, title){
  const id = getYouTubeId(urlOrId);
  const thumb = `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
  container.innerHTML = `
    <div class="yt-holder" style="position:relative;max-width:100%;aspect-ratio:16/9;border-radius:12px;overflow:hidden;background:#000">
      <img src="${thumb}" alt="Preview" style="width:100%;height:100%;object-fit:cover;display:block" loading="lazy">
      <button class="yt-play" aria-label="تشغيل الفيديو"
        style="position:absolute;inset:0;margin:auto;width:68px;height:68px;border:none;border-radius:50%;
               background:rgba(255,255,255,.9);cursor:pointer;display:grid;place-items:center">
        ▶
      </button>
    </div>`;
  const btn = container.querySelector('.yt-play');
  btn.addEventListener('click', ()=>{
    container.innerHTML = `
      <iframe
        src="https://www.youtube-nocookie.com/embed/${id}?autoplay=1&rel=0&modestbranding=1"
        loading="lazy"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen title="${title}"></iframe>`;
  });
}
